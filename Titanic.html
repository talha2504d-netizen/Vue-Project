<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Titanic Survival Predictor (TensorFlow.js)</title>

  <!-- TensorFlow.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    button {
      margin-top: 15px;
      padding: 8px 12px;
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <h1>Titanic Survival Prediction</h1>

  <button onclick="trainModel()">Train Model</button>

  <h2>Passenger Input</h2>

  <label>
    Passenger Class (1, 2, 3):
    <input type="number" id="pclass" value="3" min="1" max="3" />
  </label>

  <label>
    Sex:
    <select id="sex">
      <option value="0">Male</option>
      <option value="1">Female</option>
    </select>
  </label>

  <label>
    Age:
    <input type="number" id="age" value="30" />
  </label>

  <label>
    Fare:
    <input type="number" id="fare" value="20" />
  </label>

  <button onclick="predict()">Predict Survival</button>

  <pre id="output">Train the model first.</pre>

  <script>
    let model;
    const output = document.getElementById("output");

    // Normalize helper
    function normalize(value, min, max) {
      return (value - min) / (max - min);
    }

    async function trainModel() {
      output.textContent = "Training model...\n";

      // Small embedded Titanic-style dataset
      // [Pclass, Sex, Age, Fare] -> Survived
      const features = [
        [1, 1, 29, 211],
        [3, 0, 35, 8],
        [2, 1, 26, 26],
        [3, 0, 2, 21],
        [1, 1, 38, 71],
        [3, 0, 54, 51],
        [2, 0, 28, 13],
        [3, 1, 22, 7],
        [1, 0, 40, 80],
        [3, 1, 19, 30]
      ];

      const labels = [
        1, 0, 1, 1, 1,
        0, 0, 1, 0, 1
      ];

      // Normalize features
      const xs = tf.tensor2d(
        features.map(f => [
          f[0] / 3,                 // Pclass
          f[1],                     // Sex
          normalize(f[2], 0, 80),   // Age
          normalize(f[3], 0, 300)   // Fare
        ])
      );

      const ys = tf.tensor2d(labels, [labels.length, 1]);

      // Create model
      model = tf.sequential();

      model.add(tf.layers.dense({
        units: 8,
        activation: "relu",
        inputShape: [4]
      }));

      model.add(tf.layers.dense({
        units: 1,
        activation: "sigmoid"
      }));

      model.compile({
        optimizer: tf.train.adam(0.01),
        loss: "binaryCrossentropy",
        metrics: ["accuracy"]
      });

      // Train
      await model.fit(xs, ys, {
        epochs: 100,
        callbacks: {
          onEpochEnd: (epoch, logs) => {
            if ((epoch + 1) % 20 === 0) {
              output.textContent +=
                `Epoch ${epoch + 1}: loss=${logs.loss.toFixed(4)}\n`;
            }
          }
        }
      });

      xs.dispose();
      ys.dispose();

      output.textContent += "\nTraining complete.\n";
    }

    function predict() {
      if (!model) {
        output.textContent = "Please train the model first.";
        return;
      }

      const pclass = Number(document.getElementById("pclass").value) / 3;
      const sex = Number(document.getElementById("sex").value);
      const age = normalize(
        Number(document.getElementById("age").value),
        0,
        80
      );
      const fare = normalize(
        Number(document.getElementById("fare").value),
        0,
        300
      );

      const input = tf.tensor2d([[pclass, sex, age, fare]]);
      const prediction = model.predict(input);
      const probability = prediction.dataSync()[0];

      output.textContent =
        `Survival Probability: ${(probability * 100).toFixed(2)}%`;

      input.dispose();
      prediction.dispose();
    }
  </script>

</body>
</html>